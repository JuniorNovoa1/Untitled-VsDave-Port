function onCreatePost()
	if stringStartsWith(version, "0.7") then oldGhostTappingSetting = getPropertyFromClass("backend.ClientPrefs", "data.ghostTapping") else oldGhostTappingSetting = getPropertyFromClass("ClientPrefs", "ghostTapping") end
	if stringStartsWith(version, "0.7") then setPropertyFromClass("backend.ClientPrefs", "data.ghostTapping", false) else setPropertyFromClass("ClientPrefs", "ghostTapping", false) end
	addHaxeLibrary("FlxTween", 'flixel.tweens')
	addHaxeLibrary("FlxEase", 'flixel.tweens')
	addHaxeLibrary("Conductor")
	addHaxeLibrary("FlxPoint", "flixel.math")
end

function onSongStart()
	addHaxeLibrary("Application", 'lime.app')
	runHaxeCode([[
		var window = Application.current.createWindow({
			title: "expunged.dat",
			width: 800,
			height: 800,
			borderless: false,
			alwaysOnTop: true
		});
		window.stage.color = 0x00010101;

		var windowX = Application.current.window.x + ((Application.current.window.display.bounds.width) * 0.140625);

		var windowSteadyX = windowX;

		var expungedOffset = new FlxPoint(0,0);
		expungedOffset.x = Application.current.window.x;
		expungedOffset.y = Application.current.window.y;

		var expungedMoving = true;
		var ExpungedWindowCenterPos = new FlxPoint(0,0);
		FlxTween.tween(expungedOffset, {x: -20}, 2, {ease: FlxEase.elasticOut});

		FlxTween.tween(Application.current.window, {x: windowX}, 2.2, {
			ease: FlxEase.elasticOut,
			onComplete: function(tween)
			{
				ExpungedWindowCenterPos.x = expungedOffset.x;
				ExpungedWindowCenterPos.y = expungedOffset.y;
				expungedMoving = false;
			}
		});

		Application.current.window.focus();
	]])
end
function onDestroy()
	if stringStartsWith(version, "0.7") then setPropertyFromClass("backend.ClientPrefs", "data.ghostTapping", oldGhostTappingSetting) else setPropertyFromClass("ClientPrefs", "ghostTapping", oldGhostTappingSetting) end
end
function onUpdate(elapsed)
	runHaxeCode([[
		if (game.unspawnNotes[0] != null)
		{
			var thing = 1500;

			if (game.unspawnNotes[0].strumTime - Conductor.songPosition < thing)
			{
				var dunceNote = game.unspawnNotes[0];
				//dunceNote.finishedGenerating = true;

				game.notes.add(dunceNote);

				var index = game.unspawnNotes.indexOf(dunceNote);
				game.unspawnNotes.splice(index, 1);
			}
		}
	]])
end

local glitchText = true;
function onUpdatePost(elapsed)
	local translatedScore = getDataFromSave("UntitledVsDavePortSettings", "textInLanguages")
	if glitchText then
		setTextString("scoreTxt", "Scor3: "..tostring(score * getRandomInt(1, 9)).." | M1ss3s: "..tostring(misses * getRandomInt(1, 9)).." | Accuracy: "..tostring((math.floor(getProperty('ratingPercent') * 100, 2)) * getRandomInt(1, 9)).."%")
	end
end

function onStepHit()
	if curStep % 8 == 0 then
		local fonts = {'arial', 'chalktastic', 'openSans', 'pkmndp', 'barcode', 'vcr'};
		local chosenFont = getRandomInt(1, #fonts)
		setTextFont("kadeEngineWatermark", "exploit/"..fonts[chosenFont]..".ttf")
		setTextFont("creditsWatermark", "exploit/"..fonts[chosenFont]..".ttf")
		setTextFont("scoreTxt", "exploit/"..fonts[chosenFont]..".ttf")
		if getProperty("timeTxt") ~= nil then setTextFont("timeTxt", "exploit/"..fonts[chosenFont]..".ttf") end
	end
	if curStep == 100 then
		callOnLuas("sendNotification", {"VsDave.app", "Anticheat.dll", "Potential threat detected: expunged.dat"})
	end
end

function opponentNoteHit(membersIndex, noteData, noteType, isSustainNote)
	runHaxeCode([[
		if (((game.health + (FlxEase.backInOut(game.health / 16.5)) - 0.002) >= 0) && !(game.curBeat >= 320 && game.curBeat <= 330))
		{
			game.health += ((FlxEase.backInOut(game.health / 16.5)) * (game.curBeat <= 160 ? 0.25 : 1)) - 0.002; //some training wheels cuz rapparep say mod too hard
		}
	]]) --just copy and paste, would be impossible to do in lua for me
end